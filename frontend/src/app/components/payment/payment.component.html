<div class="min-h-screen bg-gray-50 pb-24">
  <app-header-common [titleKey]="'payment.title'"></app-header-common>

  <div class="max-w-md mx-auto px-4 py-6">
    <!-- Order Summary Card -->
    <div class="bg-white rounded-xl shadow-sm border p-4 mb-6">
      <h2 class="text-lg font-bold text-blue-900 mb-4">{{ 'cart.orderSummary' | transloco }}</h2>
      <div class="space-y-2 mb-4">
        @for (item of (cart | async)?.items; track item.id) {
          <div class="flex justify-between text-sm">
            <span class="text-gray-600">{{ item.quantity }}x {{ getItemName(item) }}</span>
            <span class="font-medium">€{{ (getItemPrice(item) * item.quantity).toFixed(2) }}</span>
          </div>
        }
      </div>
      <div class="border-t pt-3 flex justify-between items-center font-bold text-lg">
        <span>{{ 'cart.total' | transloco }}</span>
        <span class="text-blue-900">€{{ (cart | async)?.totalAmount?.toFixed(2) }}</span>
      </div>
    </div>

    <!-- Payment Methods -->
    <h2 class="text-lg font-bold text-gray-900 mb-4">{{ 'payment.selectMethod' | transloco }}</h2>
    <div class="space-y-3 mb-8">
      <!-- Credit Card -->
      <button
        (click)="selectMethod('creditCard')"
        class="w-full flex items-center p-4 bg-white border-2 rounded-xl transition-all"
        [class.border-blue-900]="selectedMethod() === 'creditCard'"
        [class.bg-blue-50]="selectedMethod() === 'creditCard'"
        [class.border-transparent]="selectedMethod() !== 'creditCard'"
      >
        <div class="p-2 rounded-lg bg-blue-100 text-blue-900 mr-4 flex items-center justify-center">
          <mat-icon>credit_card</mat-icon>
        </div>
        <span class="font-semibold">{{ 'payment.creditCard' | transloco }}</span>
        @if (selectedMethod() === 'creditCard') {
          <mat-icon class="ml-auto text-blue-900">check_circle</mat-icon>
        }
      </button>
    </div>

    <!-- Process Button -->
    <button
      (click)="processPayment()"
      [disabled]="!selectedMethod() || processing()"
      class="w-full py-4 bg-blue-900 text-white rounded-xl font-bold shadow-lg shadow-blue-900/30 disabled:opacity-50 flex items-center justify-center gap-3"
    >
      @if (processing()) {
        <div
          class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"
        ></div>
        <span>{{ 'payment.processing' | transloco }}</span>
      } @else {
        <span>{{ 'cart.checkout' | transloco }}</span>
        <mat-icon>arrow_forward</mat-icon>
      }
    </button>
  </div>

  <!-- Processing Overlay -->
  @if (processing()) {
    <div
      class="fixed inset-0 bg-white/80 backdrop-blur-sm z-[100] flex flex-col items-center justify-center"
    >
      <div
        class="w-16 h-16 border-4 border-blue-900/20 border-t-blue-900 rounded-full animate-spin mb-4"
      ></div>
      <p class="text-blue-900 font-bold text-lg">{{ 'payment.processing' | transloco }}</p>
      <p class="text-gray-500 text-sm mt-2">Verschlüsselte Verbindung wird aufgebaut...</p>
    </div>
  }
</div>
