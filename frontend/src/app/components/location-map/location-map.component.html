<div class="location-map-container">
  <!-- Machine List -->
  <div class="machine-list mt-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold">Abholorte ({{ filteredMachines.length }})</h3>
      <div class="text-sm text-gray-500">Nach Verfügbarkeit sortiert</div>
    </div>

    <!-- No Machines Message -->
    <div
      *ngIf="!loading && filteredMachines.length === 0"
      class="bg-gray-50 rounded-lg p-8 text-center"
    >
      <mat-icon class="text-gray-400 text-5xl mb-3">location_off</mat-icon>
      <p class="text-gray-600">Keine Automaten im ausgewählten Umkreis gefunden.</p>
      <p class="text-sm text-gray-500 mt-2">
        Erweitern Sie den Suchradius, um mehr Automaten anzuzeigen.
      </p>
    </div>

    <!-- Machine Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div
        *ngFor="let machine of filteredMachines"
        class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer overflow-hidden"
        [class.ring-2]="selectedMachine?.id === machine.id"
        [class.ring-blue-500]="selectedMachine?.id === machine.id"
        [class.opacity-60]="machine.is_available === false"
        (click)="selectMachine(machine)"
      >
        <!-- Card Header -->
        <div class="p-4">
          <div class="flex justify-between items-start mb-3">
            <div class="flex-1">
              <h4 class="font-semibold text-gray-900">{{ machine.name }}</h4>
              <p class="text-sm text-gray-600 mt-1">{{ machine.location }}</p>
            </div>
            <div class="text-right">
              <p class="text-lg font-bold text-blue-600" *ngIf="machine.distance">
                {{ machine.distance }} km
              </p>
            </div>
          </div>

          <!-- Status & Availability Badges -->
          <div class="flex flex-wrap gap-2 mb-3">
            <!-- Availability Badge -->
            <span
              *ngIf="machine.is_available === false"
              class="inline-flex items-center px-2 py-1 text-xs font-bold rounded-full bg-red-100 text-red-700"
            >
              <mat-icon style="font-size: 14px; width: 14px; height: 14px" class="mr-1"
                >error_outline</mat-icon
              >
              Nicht alle Artikel verfügbar
            </span>
            <span
              *ngIf="machine.is_available !== false && mode === 'select'"
              class="inline-flex items-center px-2 py-1 text-xs font-bold rounded-full bg-green-100 text-green-700"
            >
              <mat-icon style="font-size: 14px; width: 14px; height: 14px" class="mr-1"
                >check_circle_outline</mat-icon
              >
              Alle Artikel verfügbar
            </span>

            <!-- Technical Status Badge (FHIR) -->
            <span
              *ngIf="machine.status !== 'active'"
              class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full"
              [ngClass]="{
                'bg-yellow-100 text-yellow-800': machine.status === 'suspended',
                'bg-red-100 text-red-800': machine.status === 'inactive',
              }"
            >
              <span
                class="w-2 h-2 rounded-full mr-1"
                [ngClass]="{
                  'bg-yellow-500': machine.status === 'suspended',
                  'bg-red-500': machine.status === 'inactive',
                }"
              ></span>
              {{ machine.status === 'suspended' ? 'Wartung' : 'Inaktiv' }}
            </span>
          </div>

          <!-- Description / Access Instructions -->
          <div *ngIf="machine.description" class="pt-3 border-t border-gray-100">
            <p class="text-xs text-gray-500">
              <mat-icon class="text-xs align-middle mr-1">info</mat-icon>
              {{ machine.description }}
            </p>
          </div>
        </div>

        <!-- Selected Indicator -->
        <div
          *ngIf="selectedMachine?.id === machine.id && mode === 'select'"
          class="bg-blue-600 text-white text-center py-2 text-sm font-medium"
        >
          <mat-icon class="text-sm align-middle mr-1">check_circle</mat-icon>
          Ausgewählt
        </div>
      </div>
    </div>
  </div>
</div>
